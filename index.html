<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Karaokê Web — Pesquisa YouTube + Pontuação</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#ff1a3d; --muted:#9aa6b2; --glass: rgba(255,255,255,0.04);
      --max-width:1100px;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,#071022 0%, #081221 100%);
      color:#e6eef6;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:28px;
      min-height:100vh;
    }
    .app{
      width:100%;
      max-width:var(--max-width);
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:20px;
    }
    header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:6px;}
    h1{margin:0;font-size:1.25rem;letter-spacing:0.2px}
    .controls{display:flex;gap:8px;align-items:center;}
    input[type="search"]{padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:var(--glass);color:inherit;min-width:260px;}
    button{background:var(--accent);color:white;border:0;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:600;}
    .left{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:14px;border-radius:12px;min-height:60vh;}
    .player-wrap{background:#000;border-radius:10px;overflow:hidden;position:relative;padding-top:56.25%;}
    #player{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;}
    .results{margin-top:12px;display:grid;grid-template-columns: repeat(auto-fill, minmax(160px,1fr));gap:10px;}
    .result{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;cursor:pointer;display:flex;gap:8px;align-items:center;}
    .thumb{width:120px;height:68px;flex-shrink:0;border-radius:6px;object-fit:cover}
    .meta{flex:1}
    .meta h4{margin:0;font-size:0.9rem;line-height:1.1}
    .meta p{margin:4px 0 0;font-size:0.75rem;color:var(--muted)}
    .right{background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:14px;border-radius:12px;height:fit-content;display:flex;flex-direction:column;gap:12px;}
    .score-box{background:rgba(0,0,0,0.35);padding:12px;border-radius:8px}
    .big-score{font-size:2.4rem;font-weight:700;color:var(--accent);text-align:center}
    .small{font-size:0.85rem;color:var(--muted)}
    .history{max-height:320px;overflow:auto;padding:6px;border-radius:6px;background:rgba(255,255,255,0.01)}
    .hist-item{display:flex;justify-content:space-between;padding:8px;border-bottom:1px solid rgba(255,255,255,0.02)}
    footer{grid-column:1/-1;margin-top:10px;color:var(--muted);font-size:0.85rem}
    @media (max-width:900px){.app{grid-template-columns:1fr; padding-bottom:60px}.right{order:2}}
    #confetti { position: fixed; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index:9999; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Karaokê do Youtube.</h1>
      <div class="controls">
        <input id="q" type="search" placeholder="Procure uma música (ex: 'Adele Rolling in the Deep')" />
        <button id="searchBtn">Pesquisar</button>
      </div>
    </header>

    <main class="left">
      <div class="player-wrap">
        <div id="player"></div>
      </div>
      <div class="results" id="results"></div>
    </main>

    <aside class="right">
      <div class="score-box">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Pontuação</strong><div class="small">Essa é sua nota:</div></div>
          <button id="resetScores" style="background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.04);padding:6px 8px;border-radius:6px;cursor:pointer">Limpar</button>
        </div>
        <div style="margin-top:10px">
          <div class="big-score" id="lastScore">—</div>
          <div id="lastMsg" style="text-align:center;margin-top:4px;color:var(--muted)"></div>
          <div style="height:10px"></div>
          <div id="scoreBar" style="height:8px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden">
            <div id="scoreFill" style="height:100%;width:0%"></div>
          </div>
        </div>
      </div>

      <div class="score-box">
        <strong>Placar local</strong>
        <div class="history" id="history"></div>
      </div>
    </aside>

    <footer>Uma criação do Jota. Beijos, aproveitem!</footer>
    <canvas id="confetti"></canvas>
  </div>

  <script>
    const YT_API_KEY = "AIzaSyAjeqfNjSBkSh_4d4y7igxxJdSVqOQPgiw"; 
    const MAX_RESULTS = 12;
    let currentVideoId = null, currentVideoTitle = null, player = null;
    let history = JSON.parse(localStorage.getItem('karaoke_history_v1')||'[]');

    function saveHistory(){
      localStorage.setItem('karaoke_history_v1', JSON.stringify(history));
      renderHistory();
    }
    function renderHistory(){
      const box = document.getElementById('history');
      box.innerHTML = '';
      if(history.length === 0){
        box.innerHTML = '<div class="small" style="padding:12px;color:var(--muted)">Nenhuma pontuação ainda</div>';
        return;
      }
      history.slice().reverse().forEach(item=>{
        const el = document.createElement('div');
        el.className = 'hist-item';
        el.innerHTML = `<div><strong>${escapeHtml(item.title)}</strong><div class="small">${new Date(item.time).toLocaleString()}</div></div>
                        <div style="text-align:right"><div style="font-weight:700;color:var(--accent)">${item.score}</div><div class="small">${item.msg}</div></div>`;
        box.appendChild(el);
      });
    }
    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

    async function searchYouTube(q){
      if(!YT_API_KEY || YT_API_KEY.includes('COLE')) return alert('Cole sua API key no código.');
      const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=${MAX_RESULTS}&q=${encodeURIComponent(q)}&key=${YT_API_KEY}`;
      const res = await fetch(url); const data = await res.json(); renderResults(data.items||[]);
    }
    function renderResults(items){
      const wrap = document.getElementById('results');
      wrap.innerHTML = '';
      if(items.length===0){wrap.innerHTML='<div style="padding:12px;color:var(--muted)">Nenhum resultado</div>';return;}
      items.forEach(it=>{
        const id = it.id.videoId; const title = it.snippet.title;
        const thumb = it.snippet.thumbnails.medium?.url;
        const div = document.createElement('div');
        div.className='result';
        div.innerHTML=`<img class="thumb" src="${thumb}" /><div class="meta"><h4>${escapeHtml(title)}</h4><p>${escapeHtml(it.snippet.channelTitle)}</p></div>`;
        div.onclick=()=>playVideo(id,title);
        wrap.appendChild(div);
      });
    }

    function ensureYTScript(){
      if(window.ytScriptInjected) return;
      const s=document.createElement('script'); s.src="https://www.youtube.com/iframe_api"; document.body.appendChild(s);
      window.ytScriptInjected=true;
    }
    function onYouTubeIframeAPIReady(){}
    window.onYouTubeIframeAPIReady=onYouTubeIframeAPIReady;

    function playVideo(videoId,title){
      currentVideoId=videoId; currentVideoTitle=title;
      ensureYTScript();
      if(player){player.loadVideoById(videoId);}
      else{player=new YT.Player('player',{videoId,playerVars:{'playsinline':1,'rel':0},events:{'onStateChange':onPlayerStateChange,'onReady':ev=>ev.target.playVideo()}});}
      document.getElementById('lastScore').textContent='—';
      document.getElementById('lastMsg').textContent='';
      document.getElementById('scoreFill').style.width='0%';
    }
    function onPlayerStateChange(e){ if(e.data===0) handleVideoEnded(); }

    function handleVideoEnded(){
      const score = 70 + Math.floor(Math.random()*31);
      animateScore(score);
      const msgs=["Você é um cantor nato!","Melhore, querida...","Arrasou no palco!","Isso foi de arrepiar!","Quase lá, mas já brilhou!", "O importante é competir. E você... competiu.", "Você foi muito bem naquelas partes que a música fica em silêncio.", "Foi bom, mas os vizinhos pediram para abaixar o volume", "Ok, o microfone sobreviveu.", "O importante é que você se divertiu.", "O Spotify já tem essa música. Mas não essa versão.", "Isso não foi uma música. Foi uma experiência auditiva.", "UAU! Que energia! Quase quebrou o equipamento!", "Uma performance memorável.", "Nossos algoritmos não estavam preparados para isso."];
      const msg=msgs[Math.floor(Math.random()*msgs.length)];
      history.push({videoId:currentVideoId,title:currentVideoTitle,score,time:Date.now(),msg});
      if(history.length>200) history=history.slice(-200);
      saveHistory(); fireConfetti();
      document.getElementById('lastMsg').textContent=msg;
    }

    function animateScore(score){
      const el=document.getElementById('lastScore'); const bar=document.getElementById('scoreFill');
      let cur=0, steps=0;
      const id=setInterval(()=>{
        steps++;
        cur=Math.floor(Math.random()*101);
        el.textContent=cur;
        if(steps>20){el.textContent=score;bar.style.width=score+'%';clearInterval(id);}
      },100);
    }

    function fireConfetti()

    document.getElementById('searchBtn').onclick=()=>{const q=document.getElementById('q').value.trim();if(q)searchYouTube(q);}
    document.getElementById('q').addEventListener('keydown',ev=>{if(ev.key==='Enter')document.getElementById('searchBtn').click();});
    document.getElementById('resetScores').onclick=()=>{if(confirm('Limpar histórico?')){history=[];saveHistory();}};
    renderHistory();
  </script>
  <script>(function(){if(!window.YT){const s=document.createElement('script');s.src="https://www.youtube.com/iframe_api";document.head.appendChild(s);}})();</script>
</body>
</html>
